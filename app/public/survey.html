<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Can't Harley Wait Quiz</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
</head>

<body>
    <div class='container'>
        <form>
            <div class="form-group">
                <label for="user_name">Name</label>
                <input type="text" name="" id="name" class="form-control" placeholder='Enter your name' required>
            </div>
            <div class="form-group">
                <label for="user_picture">Picture</label>
                <input type="text" class="form-control" placeholder="Link to a picture of you, preferably with your bike" id="picture" required>
            </div>
            <div class="form-group">
                <label for="question1">Your friends would describe you as a 'motorcycle enthusiast' above anything else.</label>
                <select class="form-control" id="question1">
                    <option value="1">1 (strongly disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (strongly agree)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="question2">If your motorcylce gets scratched, your day is ruined.</label>
                <select class="form-control" id="question2">
                    <option value="1">1 (strongly disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (strongly agree)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="question3">You can't remember the last weekend you didn't go for a long ride.</label>
                <select class="form-control" id="question3">
                    <option value="1">1 (strongly disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (strongly agree)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="question4">You have more leather boots than flip flops.</label>
                <select class="form-control" id="question4">
                    <option value="1">1 (strongly disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (strongly agree)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="question5">You are looking for a partner who can go on long rides with you and your friends.</label>
                <select class="form-control" id="question5">
                    <option value="1">1 (strongly disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (strongly agree)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="question6">Your ideal partner has a bike of their own, but wouldn't mind saddling up on yours from time to time.</label>
                <select class="form-control" id="question6">
                    <option value="1">1 (strongly disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (strongly agree)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="question7">You find helmet hair sexy.</label>
                <select class="form-control" id="question7">
                    <option value="1">1 (strongly disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (strongly agree)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="question8"><em>Easy Rider</em> is your favorite movie.</label>
                <select class="form-control" id="question8">
                    <option value="1">1 (strongly disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (strongly agree)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="question9">You always lather up with sunblock before hitting the road.</label>
                <select class="form-control" id="question9">
                    <option value="1">1 (strongly disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (strongly agree)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="question10">You love the taste of freedom and the wind on your face.</label>
                <select class="form-control" id="question10">
                    <option value="1">1 (strongly disagree)</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5 (strongly agree)</option>
                </select>
            </div>
            <button type="submit" id='submit' class="btn btn-primary">Find my Match!</button>
        </form>
    </div>
    <!-- modal -->
    <div id="modal" class="modal fade">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">A lifetime of Happiness with...</h4>
                </div>
                <div class="modal-body">
                    <p>One fine body&hellip;</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal" id='close-modal'>&#x1f494; no thanks, find a different match</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal" id='go-home'> &#8962; back to home</button>
                </div>
            </div>
        </div>
    </div>
    <!-- end modal -->
</body>
<script type="text/javascript">
$('#modal').modal({
    show: false
});


$("#submit").on("click", function() {


    var newMatch = {
        matchName: $('#name').val(),
        matchPic: $('#picture').val(),
        matchScores: [$("#question1").val(), $("#question2").val(), $("#question3").val(), $("#question4").val(), $("#question5").val(), $("#question6").val(), $("#question7").val(), $("#question8").val(), $("#question9").val(), $("#question10").val()],
    };


    var findSum = function() {
        var sum = 0;
        for (var j = 0; j < newMatch.matchScores.length; j++) {
            sum += parseInt(newMatch.matchScores[j]);
        }
        newMatch.matchSum = parseInt(sum);
    }

    findSum();




    var currentURL = window.location.origin;
    $.post(currentURL + "/api/matches", newMatch, function(data) {
        if (data == true) {
            findMatch();
        }
        if (data == false) {
            alert("Sorry this shit don't work")
        }
    });
    return false;
});


var findMatch = function() {

    // Here we get the location of the root page. 
    // We use this instead of explicitly saying the URL is localhost:3001 because the url will change when we deploy.
    var currentURL = window.location.origin;

    // The AJAX function uses the URL of our API to GET the data associated with it (initially set to localhost)
    $.ajax({
            url: currentURL + "/api/matches",
            method: "GET"
        })
        .done(function(matchData) {

            // Here we are logging the URL so we have access to it for troubleshooting
            console.log("------------------------------------");
            console.log("URL: " + currentURL + "/api/matches");
            console.log("------------------------------------");

            console.log(matchData);
            console.log("------------------------------------")

            // find the sum of USER's score:

            var num1 = matchData.length
            var userNum = num1 - 1
            var userObj = matchData[userNum];
            var userName = userObj.matchName;
            var userPic = userObj.matchPic;
            var score = parseInt(userObj.matchSum);
            console.log(score);

            var allSums = [];
            for (var i = 0; i < matchData.length; i++) {
                var a = parseInt(Math.abs(score - matchData[i].matchSum));
                allSums.push(a);
            }

            var index = 0;
            var value = allSums[0];
            for (var h = 1; h < userNum; h++) {
                if (allSums[h] < value) {
                    value = allSums[h];
                    index = h;
                }
            }


            $('#modal .modal-body').html('<h1>' + matchData[index].matchName + '</h1>');
            $('#modal .modal-body').append('<p><img src=' + matchData[index].matchPic + ' width = 200> &hearts; &hearts; &hearts; <img src=' + userPic + ' width =200></p>');
            $('#modal').modal('show');

            $("#close-modal").on("click", function() {
                location.reload()

            });
            $("#go-home").on("click", function() {
                 window.location = '/home';

            });
        })
};
</script>

</html>
